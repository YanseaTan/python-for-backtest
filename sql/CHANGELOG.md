# 更新日志

## todo

## bug

## 2024-02-21

- bond-fut-hedge-v2 将对冲比例的依据由平均收益率改为平均溢价率。
- 增加股指期货空头移仓换月操作。
- 修正可转债每组可用资金的计算。
- 更新了自动任务程序。

## 2024-02-01

- 新增 WriteWindDataToSQL 脚本，用于将所有万得可转债日行情数据导入到数据库中（经过筛选和清洗）。
- 增加可转债-股指期货对冲回测框架及相关的设置文档。

## 2024-01-26

- 完成转债多头轮动（新上品种增加）回测脚本方法。
- 解决下级目录调用上级其他目录包的问题（注意脚本运行的路径，再进行 sys.path.append() 操作即可）。
- 完成数据入库脚本改造，实现一次性向两个数据库进行同步写入，同时从固定数据库进行读取。

## 2024-01-25

- 将无风险价差缺省值从 -9999 改为 -999，减小配置文件字符串长度，避免读取出错。
- 新增几类镍的库存类别数据，删除原有的库存数据。
- 转债与股指期货对冲的净值回测自动化脚本新增结束时间参数，并优化了图表显示效果。
- 基本面导入脚本新增 merge_data 方法，用于合并计算部分数据，并导入数据库。
- 导入到 postgre 的脚本也进行了同步的更新。
- 月差-基本面季节性走势脚本新增了对仓单数据完整性的检查，当仓单数据有缺省时（如 TA）避免报错。
- 初步建立新的数据库写入框架，每日同时更新数据至本地和服务端两个数据库作为相互备份。

## 2024-01-24

- 完成转债与股指期货对冲的净值回测自动化脚本。

## 2024-01-23

- 完成获取指定交易日所有期货品种的仓单汇总数据的方法，优化了仓单数据出图的速度。

## 2024-01-22

- 解决一处引用错误（dataframe drop 之后要习惯性进行 reset index，不然很可能会报错）。
- 新增获取所有仓单数据以及更新指定交易日仓单数据的函数。
- 新增将仓单数据导出到 excel 中的相关功能。

## 2024-01-19

- 新增简易转债量化回测脚本。
- 更新可转债基础数据以及行情数据日度获取方法。
- 更新每日配置文件输出路径。

## 2024-01-18

- 新增 “月差-基本面季节性走势” 表格输出函数，可将月差，一腿价格，基差以及库存对齐时间轴显示在一页中。
- 更新了 tushare 的 token。

## 2024-01-10

- 解决跨年后基本面数据输出的起始和终止年份错误问题。

## 2023-12-14

- 将基本面数据导出至 excel 文件的方法迁移至新建的 WriteFundsToXlsx.py 中。
- 将所有主流品种的基本面数据导入到一个表格文件中，提升数据集中度。
- 自动脚本新增等待时间，确保当上一任务完成后再执行下一任务。

## 2023-12-12

- 新增连接 postgre 的目录，实现基本面数据导入 postgre 数据库中。
- 自动脚本新增对 postgre 的数据存储处理。

## 2023-12-11

- 修复了 2023 年 2 月 29 日不存在导致的图表问题。
- 价差季节性数据导出也做了时间轴下移的效果。
- 新增大量品种的现货价格以及库存数据源。
- 完成自动化执行脚本。

## 2023-12-08

- 修改品种配置文件，将现金交割的品种设置为均不可转抛类型。
- 改善基本面数据时间轴显示效果，统一移到了图片的下方，使之看起来更清晰。

## 2023-12-05

- 查询合约组合代码时避免 order by 与 limit 混用，提升数百倍的效率。
- 优化了 cnt_of_year 的取值方式以及表格输入数据时的列数计算。

## 2023-12-04

- 完成基本面数据季节性展示（包含近四年的数据）。

## 2023-11-29

- 更新了品种配置文件，部分无注销月份的品种注销月份为空。
- 新增基本面数据输出测试。

## 2023-11-27

- 更新获取无风险价差的日期计算方式（从获取上一天改为获取上一交易日）。

## 2023-11-24

- 将基本面配置文件中的 “type” 更改为 “index_type”，避免歧义。
- 将所有基本面数据类型改为汉语，方便展示分类。

## 2023-11-23

- 扩充了基本面数据配置文件，将重要品种的主要基本面数据类型（对应天风接口）进行了录入。
- 改进了从 TFAPI 获取数据的方式，自动判断所需要更新的日期区间。
- 更改了项目的文件路径，使之更加合理。

## 2023-11-22

- 新增了从 postgre 中获取无风险价差的方法，并对其进行初步的处理，以运用到生成价差配置文件的方法中去。
- 删除了价差配置文件中的 "StorageCharge" 和 "DeliveryCharge" 字段，减少文本长度，避免服务器无法读取。

## 2023-11-21

- 去除价差中毛刺时新增对成交量的判断，若成交量小于 1000 手则删除该毛刺，避免删除有效数据。
- 品种配置文件中新增了仓单注销月份的数据，若不确定则有单一值 -1。
- 新增读取品种注销月份的能力，并自动计算不同品种跨月组合是否可转抛，根据结果计算不同的推荐价差。

## 2023-11-20

- 升级计算推荐价差的脚本，对不同年份的价差分别去除最后一个交割月的数据，避免交割月价格波动对推荐价差的影响。

## 2023-11-17

- 新增抓取天风 api 接口中期货基本面数据的脚本以及相关的配置文件。
- 升级了将价差数据写入 excel 文件的脚本，新增了对所有合约组合的支持，并进行了清洗数据的测试。
- 升级了计算推荐价差的算法，去除了毛刺数据，并同时新增了对所有合约组合的支持。

## 2023-11-15

- 计算所有跨月组合的价差数据。
- 在数据库中为 fut_code 和 spread_type 加索引，大大提升了查询效率，进而加速了脚本速度（37.85s -> 0.03s）。
- 插入价差数据至 Excel 改用二维数组的方式插入，大大加快了 Excel 文件的生成速度。
- 输出文件时会进行文件路径判断以及自动创建该日期下的路径。
- 测试 Excel 打开和不打开情况下脚本的写入效率，发现前台打开 Excel 的写入速度更快（后台打开可能分配的资源也较少）。

## 2023-11-13

- 新增 get_trade_date_set 函数，获取所有日行情数据库中缺少的交易日期合集，方便随时更新数据。

## 2023-10-24

- 在 TushareDataToMySQL 中新增更新三大市场（股票，可转债，期货）合约基本信息的功能，并加入至每日更新方法之中。
- 将输出的期货价差季节性走势表格中的数据限制为近四年数据。
- 新增获取指定交易日所有合约组合的日行情价差数据方法。

## 2023-10-23

- 将 TushareDataToMySQL 中获取昨天日期的方法更新为获取上一交易日，使脚本更加完善。
- 将未达到到期日的期货合约组合价差信息也导入到数据库中，使季节性走势中可体现出最新的价差和价格数据。
- 优化输出表格的显示效果，包括使最近年份的的趋势线更加明显以及横坐标单位值调整等。

## 2023-10-20

- 新增将指定品种不同跨月组合价差季节性走势数据导出到 Excel 的功能。
- 删除了 read_data 中多余的参数。
- 修改了生成 ProductOps 配置文件的格式。

## 2023-10-18

- 新增 DatabaseTools 文件，用于存放所有与数据库操作相关的函数，供其他文件调用。
- 将写入价差数据至 excel 中的功能迁移到了 WriteSpreadDataToXlsx 文件中，降低文件间功能的耦合性。
- 新增 UpdateSpreadConfig 文件，通过数据库中的期货价差日行情数据，统计分析得到所有品种下所有跨月组合 10% 最低价差，并以此更新行情服务器所需的价差配置文件。

## 2023-10-17

- 新增了获取指定品种在指定到期日区间内所有的相邻月组合列表函数。
- 修改了 FuturesMDToSpread 模块中导入价差数据的方式为单条数据插入，避免重复插入数据时报错中断整体运行。
- 组合合约价差日行情数据新增品种和跨月类型字段，方便后续进行分类。
- 完成了将所有合约组合在重合交易日的价差数据存入数据库的功能。
- 完成将所有组合合约价差数据导出到 excel 中，并插入图表的功能。

## 2023-10-16

- 新增每日更新期货日行情数据时，去除对主力/连续行情的存储。

## 2023-10-13

- 添加 FuturesMDToSpread 模块，可通过数据库中的期货合约日行情数据，计算所有期货合约日行情价差并存入数据库。
- FuturesMDToSpread 模块新增绘制图像的能力。

## 2023-10-12

- 去除了获取期货历史日行情时对各期货公司主力/连续合约数据的查询和存储。
- 新增每日将各类日行情自动导入对应的表中的方法。

## 2023-10-11

- 新增获取股票、可转债、期货基本信息，以及可转债和期货所有历史日行情的方法。